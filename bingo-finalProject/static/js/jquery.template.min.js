$(window).ready(function(){

    var $backGround = $("#background");
    
    function initialize() {
        $("#information").hide();

        $("#back_bt").click(function() {
            var width = $("#bf_page_menu").width();
            $("#bf_page_menu").animate({left:"+="+width+"px"});
            $("#information").fadeOut();
            $(".container").fadeIn();
        });

        $(window).resize(function() {
            resizeBackground();
        }); 
        change_side_bar();
        resizeBackground();

        addAjax(0);
    }

    function adapt_screen() {
        function change_reference_size() {
            var $reference_block = $(".reference");
            var height = $reference_block.width();
            $reference_block.css("height",height+"px");
        }

        function change_background_size() {
            var height = 2000;
            var width = $("#information").width();
            console.log($("#information").height());
            $("#overlay").css({"height":height+"px","width":width+"px"});
        }


        function change_logo_size() {
            var $teacher_img = $("#teacher_img");
            var width = $("#my_picture").width();
            var height = $(".teacher_img").width();
            console.log(height);
            $(".teacher_img").css({"height":height+"px"});
            var height =$("#my_picture").height();
            var size;
                if (width >height)
                    size = height
                else
                    size =width;
                $teacher_img.css({"width":size+"px","height":size+"px"});
        }
        change_background_size();
        change_logo_size();
        change_reference_size();
    }

    function change_side_bar() {
        var height = $(window).height();
        var width = $(window).width();
        var size = $("#menu_list > li").length;
        if (size < 10) 
            $("#bf_page_menu").css("height", height+"px");
        else {
            $("#bf_page_menu").css("height", "auto");
        }
    }

    function resizeBackground() {
        var height = $(window).height();
        var width = $(window).width();
        $backGround.css({
            'width': width+'px',
            'height': height+'px'
        });
    }

    function addMove() {
        $("#menu_list").find("li").click(function() {
            var width = $("#bf_page_menu").width();
            $("#bf_page_menu").animate({left:"-="+width+"px"});
            $(".container").fadeOut();
            $("#information").fadeIn();
        });
    }

    function addAjax(flag) {
        var $allLists = $("#menu_list > li");

        for (var count = 0; count < $allLists.length; count++) {
            var $nowList = $($allLists[count]);
            $nowList.click(function() {
                var theId = $(this).attr('id');
                $.ajax({
                    type: "get",
                    url: theId,
                    data: 'suibian=hehe',
                    dataType: "json",
                    success: function(data) {
                        if (data.state) {
                            $("#menu_list > li").each(function() {
                                $(this).remove();
                            });
                            var newList = (data.contents).split('|');
                            for (var ele in newList) {
                                var newId = theId+'/'+newList[ele];
                                if (newList[ele].length>18) {
                                    var tem_sub = newList[ele].substr(0, 18);
                                    $("#menu_list").append('<li id="'+newId+'"><a href="#" title="'+newList[ele]+'"><span class="bf_hover"></span><span>'+tem_sub+'...</span></a></li>');
                                } else {
                                    $("#menu_list").append('<li id="'+newId+'"><a href="#"><span class="bf_hover"></span><span>'+newList[ele]+'</span></a></li>');
                                }
                            }
                            change_side_bar();
                            if (data.state == 8) addAjax(1);
                            else addAjax(0);
                        } else {
                            $("#teacher_name").html(data.teacher_info.name);
                            $("#course_name").html(data.teacher_info.course_name);
                            $("#dianming").html(data.teacher_info.dianming);
                            $("#socre").html(data.teacher_info.score);

                            $("#teacher_img").attr('src', data.teacher_head)

                            $("#materials").empty();
                            var cco = 0;
                            for (var ele in data.materials) {
                                $("#materials").append('<li>'+ele+'</li>');
                                cco++;
                                if (cco == 3) break;
                            }

                            $("#points").empty();
                            for (var cco = 0; cco < data.points.length && cco < 3; cco++) {
                                $("#points").append('<li>'+(data.points)[cco]+'</li>')
                            }

                            $("#comments").empty();
                            for (var cco = 0; cco < data.comments.length && cco < 3; cco++) {
                                var now_comment = (data.comments)[cco].content+'<br/>  ('+(data.comments)[cco].author+' '+(data.comments)[cco].time+')'
                                $("#comments").append('<li>'+now_comment+'</li>');
                            }

                            $("#a_materials").attr('href', theId)
                            $("#a_points").attr('href', theId)
                            $("#a_comments").attr('href', theId)
                            $("#a_moreinfo").attr('href', theId) 

                            adapt_screen();
                        }
                    }
                });
            });
        }

        $("#back").remove();
        var ttheId = $($allLists[0]).attr('id');
        var theSplit = ttheId.split("/");
        if (theSplit.length != 2) {
            $("#back_button").append('<li id="back"><a href="#"><span class="bf_hover"></span><span>Back</span></a></li>');
            $("#back").click(function() {
                var backId = '';
                if (theSplit.length == 3) {
                    backId += '/back';
                } else {
                    for (var count = 1; count < theSplit.length-2; count++) backId += '/'+theSplit[count];
                } 
                $.ajax({
                    type: "get",
                    url: backId,
                    data: 'suibian=hehe',
                    dataType: "json",
                    success: function(data) {
                        if (data.state) {
                            $("#menu_list > li").each(function() {
                                $(this).remove();
                            });
                            var newList = (data.contents).split('|');
                            if (backId == '/back') backId = '';
                            for (var ele in newList) {
                                var newId = backId+'/'+newList[ele];
                                if (newList[ele].length>18) {
                                    var tem_sub = newList[ele].substr(0, 18);
                                    $("#menu_list").append('<li id="'+newId+'"><a href="#" title="'+newList[ele]+'"><span class="bf_hover"></span><span>'+tem_sub+'...</span></a></li>');
                                } else {
                                    $("#menu_list").append('<li id="'+newId+'"><a href="#"><span class="bf_hover"></span><span>'+newList[ele]+'</span></a></li>');
                                }
                            }
                            change_side_bar();
                            if (theSplit.length == 4) {
                                var $newLists = $("#menu_list > li");
                                for (var cou = 0; cou < $newLists.length; cou++) {
                                    $newLists[cou].onclick = null;
                                }
                            }
                            addAjax(0);
                        }
                    }
                });
            });
        }
        if (flag == 1) {
            addMove();
        }
    }

    initialize();
    $('.carousel').carousel({
      interval: 2000
    });
});